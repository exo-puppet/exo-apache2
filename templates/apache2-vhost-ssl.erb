# ###################################
# This file is managed by puppet
# PLEASE DON'T MODIFY BY HAND
# ###################################
<VirtualHost *:80>

<% if (name != 'default') -%>
<%= "    ServerName #{name}" -%>
<% end -%>

<%if server_aliases.is_a? Array -%>
<% server_aliases.each do |name| -%>
<%= "    ServerAlias #{name}\n" %><% end -%>
<% elsif server_aliases != '' -%>
<%= "    ServerAlias #{server_aliases}" -%>
<% end -%>

<% if (admin_email != '') && admin_email != false -%>
<%= "    ServerAdmin #{admin_email}" -%>
<% end -%>


    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>
    
    DocumentRoot <%= "#{document_root}\n" -%>
    <Directory <%= "#{document_root}" -%>>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>
    
    Alias /icons/ "/usr/share/apache2/icons/"
    <Directory "/usr/share/apache2/icons">
        Options Indexes MultiViews
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    
    # don't loose time with IP address lookups
    HostnameLookups Off
    
    # needed for named virtual hosts
    UseCanonicalName Off
    
    # configures the footer on server-generated documents
    ServerSignature Off
    
    # Error pages
    # FIXME Re-Activate error page
    #ErrorDocument 404 /exo-static/404.html
    #ErrorDocument 500 /exo-static/500.html
    #ErrorDocument 502 /exo-static/502.html
    #ErrorDocument 503 /exo-static/503.html
    
    #####################
    # Log configuration
    #####################
    ErrorLog        ${APACHE_LOG_DIR}/<%= name %>-error-ssl.log
    LogLevel        warn
    CustomLog       ${APACHE_LOG_DIR}/<%= name %>-access-ssl.log combined
    RewriteLog      ${APACHE_LOG_DIR}/<%= name %>-rewrite-ssl.log
    RewriteLogLevel 0

    #####################
    # SSL configuration
    #####################
    SSLEngine             on
    SSLCertificateFile    /etc/apache2/certs/cert-1294668905-170131.cer
    SSLCertificateKeyFile /etc/apache2/certs/wild.exoplatform.org.key
    SSLCertificateChainFile /etc/apache2/certs/chain-1294668905-170131.txt
    
    # configuration du SSL
    # 40-bit mini
    #SSLCipherSuite HIGH:MEDIUM:LOW:EXPORT:!ADH:!DSS:!SSLv2:!EXPORT56:@STRENGTH:+3DES:+DES
    # 128-bit mini
    SSLCipherSuite HIGH:MEDIUM:!ADH:!DSS:!SSLv2:@STRENGTH:+3DES
    SSLProtocol all -SSLv2    
    <FilesMatch "\.(cgi|shtml|phtml|php)$">
        SSLOptions +StdEnvVars
    </FilesMatch>
    <Directory /usr/lib/cgi-bin>
        SSLOptions +StdEnvVars
    </Directory>
    BrowserMatch "MSIE [2-6]" \
        nokeepalive ssl-unclean-shutdown \
        downgrade-1.0 force-response-1.0
    # MSIE 7 and newer should be able to use keepalive
    BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
    
</VirtualHost>
