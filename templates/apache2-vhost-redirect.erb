# ###################################
# This file is managed by puppet
# PLEASE DON'T MODIFY BY HAND
# ###################################
<VirtualHost *:80>

<% if (@name != 'default') -%>
<%= "    ServerName #{@name}\n" -%>
<% end -%>

<%if @server_aliases.is_a? Array -%>
<% @server_aliases.each do |name| -%>
<%= "    ServerAlias #{name}\n" %><% end -%>
<% elsif @server_aliases != '' -%>
<%= "    ServerAlias #{@server_aliases}\n" -%>
<% end -%>

<% if (@admin_email != '') && @admin_email != false -%>
<%= "    ServerAdmin #{@admin_email}\n" -%>
<% end -%>


    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>
    
    DocumentRoot <%= "#{@document_root}\n" -%>
    <Directory <%= "#{@document_root}" -%>>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>
    
    Alias /icons/ "/usr/share/apache2/icons/"
    <Directory "/usr/share/apache2/icons">
        Options Indexes MultiViews
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    
    # don't loose time with IP address lookups
    HostnameLookups Off
    
    # needed for named virtual hosts
    UseCanonicalName Off
    
    # configures the footer on server-generated documents
    ServerSignature Off
    
    #####################
    # Error pages
    #####################
<% if (@error_403_uri != '') && @error_403_uri != false -%>
<%= "    ErrorDocument 403 #{@error_403_uri}\n" -%>
<% end -%>
<% if (@error_404_uri != '') && @error_404_uri != false -%>
<%= "    ErrorDocument 404 #{@error_404_uri}\n" -%>
<% end -%>
<% if (@error_500_uri != '') && @error_500_uri != false -%>
<%= "    ErrorDocument 500 #{@error_500_uri}\n" -%>
<% end -%>
<% if (@error_502_uri != '') && @error_502_uri != false -%>
<%= "    ErrorDocument 502 #{@error_502_uri}\n" -%>
<% end -%>
<% if (@error_503_uri != '') && @error_503_uri != false -%>
<%= "    ErrorDocument 503 #{@error_503_uri}\n" -%>
<% end -%>
    
    # Allow only HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

    #####################
    # Log configuration
    #####################
    ErrorLog        ${APACHE_LOG_DIR}/<%= scope.lookupvar('name') %>-error.log
    LogLevel        warn
    CustomLog       ${APACHE_LOG_DIR}/<%= scope.lookupvar('name') %>-access.log combined
    RewriteLog      ${APACHE_LOG_DIR}/<%= scope.lookupvar('name') %>-rewrite.log
    RewriteLogLevel 0
</VirtualHost>
