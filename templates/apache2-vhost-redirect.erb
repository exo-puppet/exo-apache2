# ###################################
# This file is managed by puppet
# PLEASE DON'T MODIFY BY HAND
# ###################################
<VirtualHost *:80>

<% if (name != 'default') -%>
<%= "    ServerName #{name}" -%>
<% end -%>

<%if server_aliases.is_a? Array -%>
<% server_aliases.each do |name| -%>
<%= "    ServerAlias #{name}\n" %><% end -%>
<% elsif server_aliases != '' -%>
<%= "    ServerAlias #{server_aliases}" -%>
<% end -%>

<% if (admin_email != '') && admin_email != false -%>
<%= "    ServerAdmin #{admin_email}" -%>
<% end -%>


    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>
    
    DocumentRoot <%= "#{document_root}\n" -%>
    <Directory <%= "#{document_root}" -%>>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>
    
    Alias /icons/ "/usr/share/apache2/icons/"
    <Directory "/usr/share/apache2/icons">
        Options Indexes MultiViews
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    
    # don't loose time with IP address lookups
    HostnameLookups Off
    
    # needed for named virtual hosts
    UseCanonicalName Off
    
    # configures the footer on server-generated documents
    ServerSignature Off
    
    # Error pages
    # FIXME Re-Activate error page
    #ErrorDocument 404 /exo-static/404.html
    #ErrorDocument 500 /exo-static/500.html
    #ErrorDocument 502 /exo-static/502.html
    #ErrorDocument 503 /exo-static/503.html
    
    # Allow only HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

    ErrorLog        ${APACHE_LOG_DIR}/<%= name %>-error.log
    LogLevel        warn
    CustomLog       ${APACHE_LOG_DIR}/<%= name %>-access.log combined
    
</VirtualHost>
